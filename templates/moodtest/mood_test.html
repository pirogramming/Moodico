{% extends 'base.html' %} {% load static %} {% block extra_head %}
<link rel="stylesheet" href="{% static 'css/moodtest/mood_test.css' %}" />
{% endblock %} {% block content %}
<div class="mood-test-container">
  <div class="mood-test-header">
    <h1>✨ 무드 테스트 ✨</h1>
    <p>당신의 무드를 파악하여 맞춤형 메이크업을 추천해드려요!</p>
  </div>

  <div class="progress-bar">
    <div class="progress-fill" id="progress-fill"></div>
  </div>

  <div class="question-counter"><span id="current-question">1</span> / 10</div>

  <form id="mood-form" method="POST" action="{% url 'mood_result' %}">
    {% csrf_token %}

<div class="question-container active" data-index="0">
      <div class="question-text">Q1. 평소에 자주 입는 옷 스타일은?</div>
      <div class="answer-buttons">
        <button type="button" class="answer-btn" onclick="selectMood('러블리', 0)">
          사랑스러운 블라우스, 원피스
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('시크', 0)">
          모노톤의 시크한 정장, 가죽 재킷
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('힙', 0)">
          개성 있는 스트릿 패션
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('캐주얼', 0)">
          편안한 느낌의 꾸안꾸
        </button>
      </div>
    </div>

    <div class="question-container" data-index="1">
      <div class="question-text">Q2. 내가 선호하는 메이크업 스타일은?</div>
      <div class="answer-buttons">
        <button type="button" class="answer-btn" onclick="selectMood('내추럴', 1)">
          자연스러움
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('고급스러운', 1)">
          포인트 있는 강렬함
        </button>
      </div>
    </div>

    <div class="question-container" data-index="2">
      <div class="question-text">Q3. 편한 친구들과 놀 때는 주로?</div>
      <div class="answer-buttons">
        <button type="button" class="answer-btn" onclick="selectMood('캐주얼', 2)">
          액티브하게! 당일치기 여행, 활동적인 놀이
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('청순', 2)">
          편안하게! 조용한 카페에서 대화
        </button>
      </div>
    </div>

    <div class="question-container" data-index="3">
      <div class="question-text">Q4. 나의 휴대전화 배경화면은 주로 어떤 스타일인가요?</div>
      <div class="answer-buttons">
        <button type="button" class="answer-btn" onclick="selectMood('모던', 3)">
          심플하고 깔끔한 무채색 배경
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('힙', 3)">
          개성 있는 아티스트 작품이나 감각적인 이미지
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('내추럴', 3)">
          자연 풍경이나 잔잔한 사진
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('러블리', 3)">
          귀여운 캐릭터나 핑크/파스텔톤 이미지
        </button>
      </div>
    </div>

    <div class="question-container" data-index="4">
      <div class="question-text">Q5. 블러셔를 바른다면 어떤 느낌을 선호하나요?</div>
      <div class="answer-buttons">
        <button type="button" class="answer-btn" onclick="selectMood('러블리', 4)">
          맑고 생기 있는 핑크/코랄
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('시크', 4)">
          차분하고 분위기 있는 브라운
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('청순', 4)">
          은은한 광채가 나는 피치
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('내추럴', 4)">
          햇살에 살짝 그을린 듯한 건강한 느낌
        </button>
      </div>
    </div>

    <div class="question-container" data-index="5">
      <div class="question-text">Q6. 당신의 립 포인트는?</div>
      <div class="answer-buttons">
        <button type="button" class="answer-btn" onclick="selectMood('러블리', 5)">
          탱글탱글 글로시 립
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('시크', 5)">
          선명한 라인의 매트 립
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('모던', 5)">
          차분한 누드톤 립
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('고급스러운', 5)">
          고급스러운 벨벳 립
        </button>
      </div>
    </div>

    <div class="question-container" data-index="6">
      <div class="question-text">Q7. 사람들이 나에게 자주 하는 말은?</div>
      <div class="answer-buttons">
        <button type="button" class="answer-btn" onclick="selectMood('청순', 6)">
          단아하다/청순하다
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('힙', 6)">
          개성 있다/힙하다
        </button>
      </div>
    </div>

    <div class="question-container" data-index="7">
      <div class="question-text">Q8. 기분 좋은 날 마시고 싶은 술은?</div>
      <div class="answer-buttons">
        <button type="button" class="answer-btn" onclick="selectMood('모던', 7)">
          깔끔한 소주, 시원한 맥주
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('고급스러운', 7)">
          향이 풍부한 와인, 칵테일
        </button>
      </div>
    </div>

    <div class="question-container" data-index="8">
      <div class="question-text">Q9. 가장 좋아하는 노래 장르는?</div>
      <div class="answer-buttons">
        <button type="button" class="answer-btn" onclick="selectMood('캐주얼', 8)">
          신나는 K-POP, 팝송
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('모던', 8)">
          감각적인 재즈, 시티팝
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('힙', 8)">
          에너지 넘치는 힙합, 밴드 음악
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('내추럴', 8)">
          차분한 발라드, 어쿠스틱
        </button>
      </div>
    </div>

    <div class="question-container" data-index="9">
      <div class="question-text">Q10. 당신이 선호하는 향기는?</div>
      <div class="answer-buttons">
        <button type="button" class="answer-btn" onclick="selectMood('캐주얼', 9)">
          향긋한 생화 향, 과일 향
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('시크', 9)">
          시원하고 중성적인 우디, 머스크 향
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('청순', 9)">
          깨끗한 비누, 코튼 향
        </button>
        <button type="button" class="answer-btn" onclick="selectMood('고급스러운', 9)">
          묵직하고 우아한 장미, 앰버 향
        </button>
      </div>
    </div>

    <!-- 결과 제출 버튼 (마지막 질문에서만 표시) -->
    <div class="submit-container" id="submit-container" style="display: none">
      <button type="submit" class="submit-btn">결과 보기 ✨</button>
    </div>
  </form>
</div>

<script>
  const scores = {
    러블리: 0,
    시크: 0,
    내추럴: 0,
    캐주얼: 0,
    고급스러운: 0,
    모던: 0,
    청순: 0,
    힙: 0,
  };

  const answered = new Set();
  const totalQuestions = 10;

  function selectMood(mood, questionIndex) {
    // 중복 선택 방지
    if (answered.has(questionIndex)) return;

    scores[mood]++;
    answered.add(questionIndex);

    // 현재 질문의 모든 버튼 비활성화
    const currentQuestion = document.querySelector(
      `[data-index="${questionIndex}"]`
    );
    currentQuestion.querySelectorAll(".answer-btn").forEach((btn) => {
      btn.classList.remove("selected");
      btn.disabled = true;
    });

    // 선택된 버튼 스타일 적용
    event.target.classList.add("selected");

    // 진행률 업데이트
    updateProgress();

    // 잠시 후 다음 질문으로 이동
    setTimeout(() => {
      showNextQuestion(questionIndex);
    }, 800);
  }

  function showNextQuestion(currentIndex) {
    const nextIndex = currentIndex + 1;

    // 현재 질문 숨기기
    const currentQuestion = document.querySelector(
      `[data-index="${currentIndex}"]`
    );
    currentQuestion.classList.remove("active");

    // 다음 질문이 있으면 보여주기
    if (nextIndex < totalQuestions) {
      const nextQuestion = document.querySelector(
        `[data-index="${nextIndex}"]`
      );
      nextQuestion.classList.add("active");
    } else {
      // 마지막 질문이면 결과 제출 버튼 보여주기
      document.getElementById("submit-container").style.display = "block";
      document.getElementById("current-question").textContent = totalQuestions;
    }
  }

  function updateProgress() {
    const progress = (answered.size / totalQuestions) * 100;
    document.getElementById("progress-fill").style.width = progress + "%";
    if (answered.size === totalQuestions) {
      document.getElementById("current-question").textContent = totalQuestions;
    } else {
      document.getElementById("current-question").textContent = answered.size + 1;
    }
  }

  document.getElementById("mood-form").addEventListener("submit", function (e) {
    e.preventDefault();

    if (answered.size !== totalQuestions) {
      alert("모든 질문에 답해주세요!");
      return;
    }

    // 최대값 추출
    let resultMood = "러블리"; // default
    let maxScore = 0;
    for (const mood in scores) {
      if (scores[mood] > maxScore) {
        maxScore = scores[mood];
        resultMood = mood;
      }
    }

    // 결과를 hidden input으로 추가
    const moodInput = document.createElement("input");
    moodInput.type = "hidden";
    moodInput.name = "mood";
    moodInput.value = resultMood;
    this.appendChild(moodInput);

    // 폼 제출
    this.submit();
  });

  // 초기 진행률 설정
  updateProgress();
</script>
{% endblock %}