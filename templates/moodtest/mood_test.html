{% extends 'base.html' %} {% load static %} {% block extra_head %}
<link rel="stylesheet" href="{% static 'css/moodtest/mood_test.css' %}" />
{% endblock %} {% block content %}
<div class="mood-test-container">
  <div class="mood-test-header">
    <h1>✨ 무드 테스트 ✨</h1>
    <p>당신의 무드를 파악하여 맞춤형 메이크업을 추천해드려요!</p>
  </div>

  <div class="progress-bar">
    <div class="progress-fill" id="progress-fill"></div>
  </div>

  <div class="question-counter"><span id="current-question">1</span> / 8</div>

  <form id="mood-form" method="POST" action="{% url 'mood_result' %}">
    {% csrf_token %}

    <div class="question-container active" data-index="0">
      <div class="question-text">Q1. 오늘 하루 나는?</div>
      <div class="answer-buttons">
        <button
          type="button"
          class="answer-btn"
          onclick="selectMood('러블리', 0)"
        >
          상큼하고 기분 좋은 하루
        </button>
        <button
          type="button"
          class="answer-btn"
          onclick="selectMood('시크', 0)"
        >
          무심하고 차분한 하루
        </button>
      </div>
    </div>

    <div class="question-container" data-index="1">
      <div class="question-text">Q2. 내가 선호하는 메이크업 스타일은?</div>
      <div class="answer-buttons">
        <button
          type="button"
          class="answer-btn"
          onclick="selectMood('내추럴', 1)"
        >
          자연스러움
        </button>
        <button
          type="button"
          class="answer-btn"
          onclick="selectMood('고급스러운', 1)"
        >
          포인트 있는 강렬함
        </button>
      </div>
    </div>

    <div class="question-container" data-index="2">
      <div class="question-text">Q3. 옷 스타일을 고르자면?</div>
      <div class="answer-buttons">
        <button
          type="button"
          class="answer-btn"
          onclick="selectMood('내추럴', 2)"
        >
          편안한 캐주얼
        </button>
        <button
          type="button"
          class="answer-btn"
          onclick="selectMood('시크', 2)"
        >
          스타일리시한 연출
        </button>
      </div>
    </div>

    <div class="question-container" data-index="3">
      <div class="question-text">Q4. 내가 끌리는 컬러는?</div>
      <div class="answer-buttons">
        <button
          type="button"
          class="answer-btn"
          onclick="selectMood('러블리', 3)"
        >
          코랄/핑크 계열
        </button>
        <button
          type="button"
          class="answer-btn"
          onclick="selectMood('고급스러운', 3)"
        >
          딥한 브라운/버건디
        </button>
      </div>
    </div>

    <div class="question-container" data-index="4">
      <div class="question-text">Q5. 약속 있는 날, 나는?</div>
      <div class="answer-buttons">
        <button
          type="button"
          class="answer-btn"
          onclick="selectMood('활기찬', 4)"
        >
          밝고 친근한 인상
        </button>
        <button
          type="button"
          class="answer-btn"
          onclick="selectMood('시크', 4)"
        >
          시크한 인상
        </button>
      </div>
    </div>

    <div class="question-container" data-index="5">
      <div class="question-text">Q6. 파우치 안 필수템은?</div>
      <div class="answer-buttons">
        <button
          type="button"
          class="answer-btn"
          onclick="selectMood('러블리', 5)"
        >
          촉촉한 틴트
        </button>
        <button
          type="button"
          class="answer-btn"
          onclick="selectMood('고급스러운', 5)"
        >
          음영 섀도우
        </button>
      </div>
    </div>

    <div class="question-container" data-index="6">
      <div class="question-text">Q7. 사람들이 나에게 자주 하는 말은?</div>
      <div class="answer-buttons">
        <button
          type="button"
          class="answer-btn"
          onclick="selectMood('활기찬', 6)"
        >
          귀엽다/밝다
        </button>
        <button
          type="button"
          class="answer-btn"
          onclick="selectMood('시크', 6)"
        >
          분위기 있다/도도하다
        </button>
      </div>
    </div>

    <!-- 결과 제출 버튼 (마지막 질문에서만 표시) -->
    <div class="submit-container" id="submit-container" style="display: none">
      <button type="submit" class="submit-btn">결과 보기 ✨</button>
    </div>
  </form>
</div>

<script>
  const scores = {
    러블리: 0,
    시크: 0,
    내추럴: 0,
    활기찬: 0,
    고급스러운: 0,
  };

  const answered = new Set();
  const totalQuestions = 7;

  function selectMood(mood, questionIndex) {
    // 중복 선택 방지
    if (answered.has(questionIndex)) return;

    scores[mood]++;
    answered.add(questionIndex);

    // 현재 질문의 모든 버튼 비활성화
    const currentQuestion = document.querySelector(
      `[data-index="${questionIndex}"]`
    );
    currentQuestion.querySelectorAll(".answer-btn").forEach((btn) => {
      btn.classList.remove("selected");
      btn.disabled = true;
    });

    // 선택된 버튼 스타일 적용
    event.target.classList.add("selected");

    // 진행률 업데이트
    updateProgress();

    // 잠시 후 다음 질문으로 이동
    setTimeout(() => {
      showNextQuestion(questionIndex);
    }, 800);
  }

  function showNextQuestion(currentIndex) {
    const nextIndex = currentIndex + 1;

    // 현재 질문 숨기기
    const currentQuestion = document.querySelector(
      `[data-index="${currentIndex}"]`
    );
    currentQuestion.classList.remove("active");

    // 다음 질문이 있으면 보여주기
    if (nextIndex < totalQuestions) {
      const nextQuestion = document.querySelector(
        `[data-index="${nextIndex}"]`
      );
      nextQuestion.classList.add("active");
    } else {
      // 마지막 질문이면 결과 제출 버튼 보여주기
      document.getElementById("submit-container").style.display = "block";
    }
  }

  function updateProgress() {
    const progress = (answered.size / totalQuestions) * 100;
    document.getElementById("progress-fill").style.width = progress + "%";
    document.getElementById("current-question").textContent = answered.size + 1;
  }

  document.getElementById("mood-form").addEventListener("submit", function (e) {
    e.preventDefault();

    if (answered.size !== totalQuestions) {
      alert("모든 질문에 답해주세요!");
      return;
    }

    // 최대값 추출
    let resultMood = "러블리"; // default
    let maxScore = 0;
    for (const mood in scores) {
      if (scores[mood] > maxScore) {
        maxScore = scores[mood];
        resultMood = mood;
      }
    }

    // 결과를 hidden input으로 추가
    const moodInput = document.createElement("input");
    moodInput.type = "hidden";
    moodInput.name = "mood";
    moodInput.value = resultMood;
    this.appendChild(moodInput);

    // 폼 제출
    this.submit();
  });

  // 초기 진행률 설정
  updateProgress();
</script>
{% endblock %}
